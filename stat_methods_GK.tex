\documentclass[12pt]{extarticle}
\usepackage[utf8]{inputenc}
\usepackage{cite}
\usepackage{amsmath}

\usepackage{xspace}
\newcommand{\ie}{\emph{i.e.}\xspace}

\title{Statistical Methods}
\date{}

\begin{document}

\maketitle

\section*{Description of the data}
We sought to characterize the dynamics of trimethylation at histone H3 at lysine 36 (H3K36me3) in a large number of genes in three biological conditions: after light activation of Set2 (writer add), and after dark inactivation of Set2 with and without the presence of Rpd3 (writer loss and writer eraser loss, respectively). H3K36me3 levels were measured through ChIP-seq across four timepoints for each condition (0/20/40/60 min for writer add and 0/30/60/90 min for the loss conditions) for 5,368 genes. Seq data was measured from three sample replicates for each condition across the timepoints. We used two different approaches to process the seq data for analysis. First, within each replicate, H3K36me3 levels for a gene and condition were scaled to the proportion of maximum H3K36me3 level observed (for said replicate, gene, and condition), resulting in a common scale across all replicates, genes, and conditions. Second, we took the measurements, previously standardized based on spike-in samples and normalized to adjust for gene length, multiplied them by 1000, and rounded to an integer, resulting in count data with a distribution proportional to the starting data. 

\section*{General statistical model}
Though the H3K36me3 data are large and well-balanced, with the vast majority of genes having complete measurements of three replicates from each condition across four timepoints, they possess challenging features from a statistical modeling perspective. Namely, the statistical model should accommodate the non-normal distribution of the H3K36me3 measurements, as well as the time course, \ie longitudinal, nature of measurements within a replicate. This broad range of features can be flexibly handled using Bayesian inference \cite{Gelman2006}. 
	The Stan statistical platform \cite{Carpenter2017} is one such computational tool for fitting complex Bayesian hierarchical models. We used the brms software package \cite{Burkner2017, Burkner2018}, which acts as a wrapper of Stan in the R statistical programming language \cite{RCoreTeam2019}. Let $y_{ijkl}$ be the H3K36me3 measurement for the $i$\textsuperscript{th} replicate sample ($i=1,2,3$) at the $j$\textsuperscript{th} timepoint ($j=0,1,2,3$) for the $k$\textsuperscript{th} gene ($k=1,2,â€¦,5368$) for $l$\textsuperscript{th} condition ($l=1,2,3$). Briefly, we model $y$ with a GLM by defining $E(y)=g^{-1}(\eta)$, where $E(.)$ is the expected value of a random variable, $g^{-1}(.)$ is the inverse link function, and $\eta$ is the linear predictor that relates the outcome to factors of interest.
	A Bayesian analysis could in principle simultaneously model all genes and conditions, though in practice, such an approach would likely be computationally infeasible, particularly when considering the need for sufficient sampling in order for the parameter estimates to converge. To avoid these challenges, we instead model more manageable subsets of H3K36me3 data. First, we fit a model of H3K36me3 data for a specific gene and condition. Second, to make more direct comparisons between the writer loss and writer eraser loss conditions, we modeled their data jointly within a gene.
	
\section*{Zero-one-inflated Beta regression model of H3K36me3 proportions}
For the H3K36me3 data transformed to the proportion scale, we modeled the data with a zero-one-inflated beta distribution (ZOIB) and the following parameterization:
\begin{equation}
	p(y_{i}) = \begin{cases} 
      			\alpha(1 - \gamma) & y_{i} = 0 \\
      			\alpha \gamma & y_{i} = 1 \\
     			 \frac{y_{i}^{\mu\phi - 1}(1 - y_{i})^{(1 - \mu)\phi - 1}}{B(\mu \phi, (1 - \mu)\phi)} & y_{i} \not\in \{0, 1\}
   		\end{cases}
\end{equation}
$\alpha$ is the zero-one-inflation probability (probability that a zero or one occurs), $\gamma$ is the conditional one-inflation probability (probability that one occurs rather than zerio), $B(.)$ is the beta function \cite{Casella2002}, and $\phi$ is a positive precision parameter. For the link function, we used the logit: $g(\eta)= \log\large(\frac{\eta}{1 - \eta}\large)$. Zero-one-inflation was used because standard beta regression expects $y \in (0, 1)$, but not at the boundaries.

The H3K36me3 data scaled to the proportion of the maximum H3K36me3 measured within a replicate (three replicates per gene per condition) results in three values of 1 for each gene and condition pairing. Additionally, zeros may observed. We used this scale of the data to better standardize ChIP-seq dynamics across cells and better detect consistent patterns compared to the normalized ChIP-seq data. However, it represents a challenging scale in the context of a GLMM. The zeros and ones are informative, but would strongly violate the assumptions and expectations of standard beta regression, resulting in anti-conservative, extreme parameter estimates. Instead, we used ZOIB regression, which conservatively drops out zeros and ones in terms of parameter estimation, resulting in less extreme estimates for the time effect. Alternatively, we modeled the non-proportional, normalized ChIP-seq data.

\subsection*{Continuous time model}

We modeled the gain or loss of H3K36me3 with a continuous time variable in the linear predictor of the model, 
\begin{equation}
	\eta_{ij} = \mu + \alpha_{i} + (\beta_{\text{time}} + \delta_{i})x_{ij},
\end{equation}
where $\mu$ is a shared intercept term, $x_{ij}$ is the $j$\textsuperscript{th} timepoint (in minutes) for the $i$\textsuperscript{th} replicate, and $\beta_{\text{time}}$ is the log odds ratio (OR) for change in proportion H3K36me3 (relative to the maximum) per minute. For all genes and conditions, we recorded the posterior mean ($\widehat{\beta}_{\text{time}, kl}$) as a point estimate for the change in H3K36me3 proportion with time for gene $k$ and condition $l$, the standard error on the estimate, and the 95\% Credible Interval (CrI), which we use to define ``confident'' genes for a given condition, which possess CrI that do not cover 0. $\widehat{\beta}_{\text{time}, kl}$ were plotted and correlated with additional factors of interests in order to identify interesting trends.

\subsection*{Categorical time model}

Notably, writer loss and writer eraser loss had similar H3K36me3 dynamics with time. To more directly compare the dynamics of writer loss and writer eraser loss, we simultaneously analyzed their data per gene within a categorical time model, allowing for greater flexibility and non-linearity with respect to time:
\begin{equation}
	\eta_{ij} = \mu + \sum_{p = 1}^{3}\beta_{\text{timepoint}}^{p}I\{j = p\} + \sum_{q = 0}^{3}\delta_{\text{timepoint}}^{q}I\{j = q\},
\end{equation}
where $\mu$ is the intercept representing log odds for the proportion H3K36me3 at time0 for writer loss, $\beta_{\text{timepoint}}^{p}$ is the log OR comparing timepoint $p$ to $0$ for writer loss, and $\delta_{\text{timepoint}}^{q}$ represents deviations at each timepoint for writer eraser loss.

\bibliographystyle{plain}
\bibliography{stat_methods_GK}

\end{document}